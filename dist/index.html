<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Shopping List</title>
		<link rel="manifest" href="/manifest.json" />
		<style>
			input[type="text"] {
				border-width: 1px;
				padding: 0.5rem 0.75rem;
			}
			[x-cloak] {
				display: none !important;
			}
		</style>
		<script type="module" crossorigin src="/assets/main-DjorNhVf.js"></script>
		<link rel="modulepreload" crossorigin href="/assets/auth-By3jkay-.js">
		<link rel="stylesheet" crossorigin href="/assets/main-BocJs6YP.css">
	</head>
	<body class="font-inter">
		<main class="container mx-auto mt-6 flex">
			<div
				class="mx-auto w-11/12 max-w-3xl"
				x-data="groceryApp()"
				x-init="init()"
			>
				<h2 class="text-2xl text-gray-900 flex py-2">
					<img src="/icon.png" class="object-scale-down w-8 h-8" alt="grocery bag" />
					Shopping List
				</h2>

				<!-- Search bar -->
				<div class="flex items-stretch flex-grow px-4 py-2">
					<input
						id="search"
						type="text"
						name="search"
						class="block w-full rounded-none rounded-l-md sm:text-sm border-gray-300"
						placeholder="Search"
						x-model="search"
						@keyup.enter="loadItems()"
						@input.debounce.300ms="loadItems()"
					/>
					<button @click="clearSearch()">
						<span class="sr-only">Clear</span>
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mx-2 my-2">
							<path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
						</svg>
					</button>
				</div>

				<!-- Items container -->
				<div id="items-container" class="block max-w-full w-full bg-gray-100 py-4 px-4 border border-gray-200 rounded shadow-sm">
					<div class="border-b border-gray-200 w-full">
						<!-- Tag filter -->
						<template x-if="filterTag">
							<div class="px-1 mx-4 text-white bg-gray-400 rounded w-min">
								<button @click="clearFilter()" x-text="filterTag"></button>
							</div>
						</template>

						<!-- Tabs -->
						<ul class="flex space-x-2 justify-center">
							<li>
								<button
									@click="purchased = false; loadItems()"
									class="inline-block py-4 px-4 text-lg font-medium text-center border-b-2 hover:text-gray-600 hover:border-gray-300"
									:class="!purchased ? 'text-gray-900 border-gray-900' : 'text-gray-500 border-transparent'"
								>Need</button>
							</li>
							<li>
								<button
									@click="purchased = true; loadItems()"
									class="inline-block py-4 px-4 text-lg font-medium text-center border-b-2 hover:text-gray-600 hover:border-gray-300"
									:class="purchased ? 'text-gray-900 border-gray-900' : 'text-gray-500 border-transparent'"
								>Bought</button>
							</li>
						</ul>
					</div>

					<!-- Items list -->
					<ul id="items">
						<!-- Loading state -->
						<li x-show="loading" x-cloak>...</li>

						<!-- Items -->
						<template x-for="item in items" :key="item.id">
							<li
								class="py-2 border-b border-gray-300"
								x-data="{ editing: false }"
							>
								<!-- View mode -->
								<div x-show="!editing" class="flex justify-between items-center space-x-2">
									<div class="flex justify-start space-x-3">
										<!-- Toggle purchased button -->
										<button
											:class="item.purchased ? 'bg-green-600' : 'bg-gray-400'"
											class="px-2 py-2 rounded"
											@click="toggleBought(item)"
										>
											<span class="sr-only" x-text="item.purchased ? 'Mark as unpurchased' : 'Mark as purchased'"></span>
											<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-white" viewBox="0 0 20 20" fill="currentColor">
												<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
											</svg>
										</button>
									</div>

									<div class="flex flex-col justify-start w-full">
										<div class="flex flex-row">
											<span :class="item.purchased ? 'line-through' : ''" x-text="item.name"></span>
										</div>
										<div class="flex flex-row text-sm">
											<template x-for="tag in (item.tags || '').split(' ').filter(t => t)" :key="tag">
												<div class="mx-1 px-1 bg-gray-400 rounded text-white">
													<button @click="setFilter(tag)" x-text="tag"></button>
												</div>
											</template>
										</div>
										<template x-if="!item.purchased && item.notes">
											<div class="text-sm text-gray-500 mt-1 ml-1">Notes: <span x-text="item.notes"></span></div>
										</template>
									</div>

									<!-- Edit button -->
									<button class="bg-green-600 px-2 py-2 rounded" @click="editing = true">
										<span class="sr-only">Edit</span>
										<svg class="w-3 h-3 text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
											<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7.418 17.861 1 20l2.139-6.418m4.279 4.279 10.7-10.7a3.027 3.027 0 0 0-2.14-5.165c-.802 0-1.571.319-2.139.886l-10.7 10.7m4.279 4.279-4.279-4.279m2.139 2.14 7.844-7.844m-1.426-2.853 4.279 4.279"/>
										</svg>
									</button>

									<!-- Delete button -->
									<button class="bg-red-600 px-2 py-2 rounded" @click="removeItem(item)">
										<span class="sr-only">Delete</span>
										<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-white" viewBox="0 0 20 20" fill="currentColor">
											<path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
										</svg>
									</button>
								</div>

								<!-- Edit mode -->
								<div x-show="editing" x-cloak class="flex flex-col space-y-2">
									<div class="flex items-stretch flex-grow">
										<label for="name" class="sr-only">Name</label>
										<input type="text" name="name" class="block w-full rounded-md sm:text-sm border-gray-300" placeholder="Name" x-model="item.name" />
									</div>
									<div class="flex items-stretch flex-grow">
										<label for="tags" class="sr-only">Tags</label>
										<input type="text" name="tags" class="block w-full rounded-md sm:text-sm border-gray-300" placeholder="Tags" x-model="item.tags" />
									</div>
									<template x-if="!item.purchased">
										<div class="flex items-stretch flex-grow">
											<label for="notes" class="sr-only">Notes</label>
											<input type="text" name="notes" class="block w-full rounded-md sm:text-sm border-gray-300" placeholder="Notes (e.g., quantity, variety)" x-model="item.notes" />
										</div>
									</template>
									<div class="flex items-stretch flex-grow">
										<button
											class="w-full relative px-4 py-2 border border-blue-600 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
											@click="saveItem(item); editing = false"
										>
											Update
										</button>
									</div>
								</div>
							</li>
						</template>
					</ul>

					<!-- Add new item form -->
					<div class="py-2 px-4">
						<!-- Error message -->
						<div x-show="error" x-cloak class="mb-2 p-2 text-sm text-red-700 bg-red-100 rounded" x-text="error"></div>

						<label for="name" class="sr-only">Item name</label>
						<input type="text" name="name" class="block w-full rounded-none sm:text-sm border-gray-300" placeholder="Item name..." x-model="newItem.name" />
						<div class="mt-1">
							<label for="notes" class="sr-only">Notes</label>
							<input type="text" name="notes" class="block w-full rounded-none sm:text-sm border-gray-300" placeholder="Notes (e.g., quantity, variety)..." x-model="newItem.notes" />
						</div>
						<div class="flex item-stretch flex-grow mt-1">
							<label for="tag_list" class="sr-only">Tags</label>
							<input type="text" name="tag_list" class="block w-full rounded-none sm:text-sm border-gray-300" placeholder="Tags..." x-model="newItem.tags" />
							<button
								type="submit"
								class="-ml-px relative px-4 py-2 border border-blue-600 text-sm font-medium rounded-r-md text-white bg-blue-600 hover:bg-blue-700"
								@click="addItem()"
							>
								Add
							</button>
						</div>
					</div>
				</div>
			</div>
		</main>
	</body>
</html>
